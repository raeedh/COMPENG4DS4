%% LaTeX2e file `./sections/p3_main.tex'
%% generated by the `filecontents' environment
%% from source `lab2' on 2023/03/03.
%%
\begin{lstlisting}[language=c,caption=Problem 3 main, label=list:p3_main]
int main(void) {
    BaseType_t status;
    /* Init board hardware. */
    BOARD_InitBootPins();
    BOARD_InitBootClocks();
    BOARD_InitDebugConsole();

    usr_str = malloc(sizeof(char) * 100);

    SemaphoreHandle_t *semaphores = (SemaphoreHandle_t*) malloc(3 * sizeof(SemaphoreHandle_t));

    semaphores[0] = xSemaphoreCreateBinary(); // Producer1_sem
    semaphores[1] = xSemaphoreCreateBinary(); // Producer2_sem
    semaphores[2] = xSemaphoreCreateCounting(2, 2); // consumer_sem

    status = xTaskCreate(producer_sem, "producer", 200, (void*) semaphores, 2, NULL);
    if (status != pdPASS) {
        PRINTF("Task creation failed!.\r\n");
        while (1)
            ;
    }

    status = xTaskCreate(consumer1_sem, "consumer", 200, (void*) semaphores, 2, NULL);
    if (status != pdPASS) {
        PRINTF("Task creation failed!.\r\n");
        while (1)
            ;
    }

    status = xTaskCreate(consumer2_sem, "consumer", 200, (void*) semaphores, 3, NULL);
    if (status != pdPASS) {
        PRINTF("Task creation failed!.\r\n");
        while (1)
            ;
    }

    vTaskStartScheduler();

    while (1) {
    }
}
\end{lstlisting}
